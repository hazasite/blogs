<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creator Studio - HAZA</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    
    <style>
        :root { --primary: #6366f1; --glass-bg: rgba(255, 255, 255, 0.03); --glass-border: rgba(255, 255, 255, 0.08); }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Space Grotesk', sans-serif; scroll-behavior: smooth; }
        body { background-color: #050505; color: #fff; min-height: 100vh; overflow-x: hidden; background-image: radial-gradient(circle at 10% 10%, #1a1a2e 0%, #000 40%); }
        #bg-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.4; }

        .studio-nav {
            display: flex; justify-content: space-between; align-items: center;
            padding: 1.5rem 3rem; border-bottom: 1px solid var(--glass-border);
            background: rgba(0,0,0,0.6); backdrop-filter: blur(10px);
            position: sticky; top: 0; z-index: 50; flex-wrap: wrap;
        }
        .studio-logo { font-size: 1.5rem; font-weight: 700; } .studio-logo span { color: var(--primary); }
        .user-info { display: flex; align-items: center; gap: 15px; color: #aaa; font-size: 0.9rem; }
        .logout-btn { color: #ef4444; cursor: pointer; text-decoration: none; font-weight: bold; }

        .main-wrapper {
            display: grid; grid-template-columns: 2.5fr 1fr; gap: 2rem;
            max-width: 1400px; margin: 0 auto; padding: 2rem; height: calc(100vh - 80px);
        }

        .editor-section {
            background: var(--glass-bg); border: 1px solid var(--glass-border);
            border-radius: 24px; padding: 3rem; display: flex; flex-direction: column;
            backdrop-filter: blur(20px); animation: slideUp 0.6s ease-out;
        }
        input.title-input { width: 100%; background: transparent; border: none; color: #fff; font-size: 2.5rem; font-weight: bold; margin-bottom: 1.5rem; outline: none; border-bottom: 2px solid transparent; transition: 0.3s; }
        input.title-input:focus { border-bottom-color: var(--primary); }
        .content-area { flex-grow: 1; width: 100%; background: rgba(0,0,0,0.2); border-radius: 12px; border: 1px solid var(--glass-border); padding: 2rem; color: #ddd; font-size: 1.1rem; line-height: 1.7; outline: none; overflow-y: auto; resize: none; }
        
        .toolbar { display: flex; justify-content: space-between; align-items: center; margin-top: 1.5rem; }
        .btn-publish { background: linear-gradient(135deg, var(--primary), #4f46e5); color: white; padding: 0.8rem 2.5rem; border-radius: 50px; border: none; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 8px; box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4); }

        .history-section {
            background: rgba(0,0,0,0.2); border-left: 1px solid var(--glass-border);
            border-radius: 24px; padding: 1.5rem; display: flex; flex-direction: column;
        }
        .history-list { overflow-y: auto; flex-grow: 1; padding-right: 5px; }
        .history-card { background: rgba(255,255,255,0.03); border: 1px solid var(--glass-border); padding: 1rem; border-radius: 16px; margin-bottom: 1rem; position: relative; }
        .badge { font-size: 0.7rem; padding: 2px 8px; border-radius: 4px; font-weight: bold; text-transform: uppercase; }
        .badge.pending { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
        .badge.approved { background: rgba(16, 185, 129, 0.2); color: #10b981; }
        .btn-del-cloud { background: none; border: none; color: #ef4444; cursor: pointer; position: absolute; top: 10px; right: 10px; }

        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

        /* --- MOBILE RESPONSIVE --- */
        @media (max-width: 900px) {
            .studio-nav { padding: 1rem; flex-direction: column; gap: 10px; }
            .main-wrapper { grid-template-columns: 1fr; height: auto; padding: 1rem; }
            .editor-section { padding: 1.5rem; min-height: 500px; }
            .history-section { height: 400px; border-left: none; border-top: 1px solid var(--glass-border); }
            input.title-input { font-size: 1.8rem; }
            .btn-publish { width: 100%; justify-content: center; }
            .toolbar { flex-direction: column; gap: 10px; align-items: stretch; }
            .status-text { text-align: center; margin-bottom: 5px; }
        }
    </style>
</head>
<body>
    <canvas id="bg-canvas"></canvas>
    <nav class="studio-nav">
        <div class="studio-logo">HAZA <span>STUDIO</span></div>
        <div class="user-info">
            <span id="welcomeMsg">Welcome</span> | <a href="index.html" style="color:white; text-decoration:none;">Home</a> | <a href="#" onclick="logout()" class="logout-btn">Log Out</a>
        </div>
    </nav>
    <div class="main-wrapper">
        <div class="editor-section">
            <input type="text" id="title" class="title-input" placeholder="Give your story a title...">
            <div id="content" class="content-area" contenteditable="true"></div>
            <div class="toolbar">
                <span class="status-text">Live Sync Enabled</span>
                <button class="btn-publish" id="publishBtn"><i class="ri-send-plane-fill"></i> Publish Article</button>
            </div>
        </div>
        <aside class="history-section">
            <div class="history-header"><i class="ri-cloud-line" style="color:var(--primary)"></i> Cloud History</div>
            <div id="history-list" class="history-list">
                <p style="color:#666; text-align:center;">Loading cloud data...</p>
            </div>
        </aside>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc, query, where, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // --- PASTE YOUR FIREBASE CONFIG HERE ---
        const firebaseConfig = {
          apiKey: "AIzaSyCiUPmia8ghmmIqvYnLI1buFlHwidIBUGQ",
          authDomain: "haza-blogs-db.firebaseapp.com",
          projectId: "haza-blogs-db",
          storageBucket: "haza-blogs-db.firebasestorage.app",
          messagingSenderId: "905964768932",
          appId: "1:905964768932:web:fd7560575fe191cf7fa031",
          measurementId: "G-T93VNP6D4D"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const user = JSON.parse(localStorage.getItem('haza_user'));
        if(!user) { window.location.href = 'login.html'; }
        document.getElementById('welcomeMsg').innerText = `Hello, ${user.name}`;

        async function loadCloudHistory() {
            const list = document.getElementById('history-list');
            list.innerHTML = `<p style="color:#666; text-align:center; margin-top:20px;"><i class="ri-loader-4-line ri-spin"></i> Syncing...</p>`;
            try {
                const q = query(collection(db, "articles"), where("author", "==", user.name));
                const querySnapshot = await getDocs(q);
                let articles = [];
                querySnapshot.forEach((doc) => { articles.push({ id: doc.id, ...doc.data() }); });
                articles.sort((a, b) => b.createdAt - a.createdAt);
                list.innerHTML = "";
                if(articles.length === 0) { list.innerHTML = `<div style="text-align:center; padding:2rem; color:#666;">No articles found.</div>`; return; }
                articles.forEach((article) => {
                    let statusBadge = article.status === 'approved' ? `<span class="badge approved"><i class="ri-check-double-line"></i> Approved</span>` : `<span class="badge pending"><i class="ri-time-line"></i> Pending</span>`;
                    const div = document.createElement('div');
                    div.className = 'history-card';
                    div.innerHTML = `
                        <div class="h-title">${article.title}</div>
                        <div class="h-date"><span>${article.date}</span>${statusBadge}</div>
                        <button class="btn-del-cloud" onclick="deleteRealArticle('${article.id}')" title="Delete from Server"><i class="ri-delete-bin-line"></i></button>
                    `;
                    list.appendChild(div);
                });
            } catch(e) { console.error(e); list.innerHTML = `<p style="color:red; text-align:center;">Connection Error</p>`; }
        }

        window.deleteRealArticle = async function(docId) {
            if(!confirm("Permanently delete this article from the server?")) return;
            try { await deleteDoc(doc(db, "articles", docId)); loadCloudHistory(); } catch(e) { alert("Error deleting: " + e.message); }
        }

        document.getElementById('publishBtn').addEventListener('click', async () => {
            const btn = document.getElementById('publishBtn');
            const title = document.getElementById('title').value;
            const content = document.getElementById('content').innerText;
            if(!title || !content.trim()) { alert("Please write something!"); return; }
            btn.innerHTML = `<i class="ri-loader-4-line ri-spin"></i> Uploading...`; btn.style.opacity = "0.7";
            try {
                await addDoc(collection(db, "articles"), { title: title, content: content, author: user.name, status: 'pending', date: new Date().toLocaleDateString(), createdAt: Date.now() });
                alert("Submitted!"); document.getElementById('title').value = ""; document.getElementById('content').innerText = ""; btn.innerHTML = `<i class="ri-send-plane-fill"></i> Publish Article`; btn.style.opacity = "1";
                loadCloudHistory();
            } catch (e) { alert("Error: " + e.message); btn.innerHTML = `Failed`; }
        });

        window.logout = function() { localStorage.removeItem('haza_user'); window.location.href = 'login.html'; }
        loadCloudHistory();

        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('bg-canvas'), alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        const particlesGeom = new THREE.BufferGeometry();
        const particlesCount = 300;
        const posArray = new Float32Array(particlesCount * 3);
        for(let i=0; i<particlesCount*3; i++) posArray[i] = (Math.random() - 0.5) * 15;
        particlesGeom.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
        const particlesMat = new THREE.PointsMaterial({ size: 0.03, color: 0x6366f1, transparent: true, opacity: 0.6 });
        const particlesMesh = new THREE.Points(particlesGeom, particlesMat);
        scene.add(particlesMesh); camera.position.z = 4;
        function animate() { requestAnimationFrame(animate); particlesMesh.rotation.y += 0.001; particlesMesh.rotation.x -= 0.0005; renderer.render(scene, camera); }
        animate();
    </script>
</body>
</html>